"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[219],{17633:function(De,z,n){n.r(z),n.d(z,{default:function(){return He}});var ee=n(5574),u=n.n(ee),ne=n(15009),i=n.n(ne),te=n(97857),d=n.n(te),W=n(99289),I=n.n(W),_=n(612),x=n(80854);function U(o,s){return $.apply(this,arguments)}function $(){return $=I()(i()().mark(function o(s,r){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.request)("/api/v1/ingresses",d()({method:"GET",params:d()({},s)},r||{})));case 1:case"end":return t.stop()}},o)})),$.apply(this,arguments)}function G(o,s){return j.apply(this,arguments)}function j(){return j=I()(i()().mark(function o(s,r){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.request)("/api/v1/ingresses/one/yaml",d()({method:"GET",params:d()({},s)},r||{})));case 1:case"end":return t.stop()}},o)})),j.apply(this,arguments)}function S(o,s){return P.apply(this,arguments)}function P(){return P=I()(i()().mark(function o(s,r){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.request)("/api/v1/ingresses/one/whitelist",d()({method:"GET",params:d()({},s)},r||{})));case 1:case"end":return t.stop()}},o)})),P.apply(this,arguments)}function B(o,s){return p.apply(this,arguments)}function p(){return p=I()(i()().mark(function o(s,r){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.request)("/api/v1/ingresses/one/whitelist",d()({method:"POST",data:d()({},s)},r||{})));case 1:case"end":return t.stop()}},o)})),p.apply(this,arguments)}function Ae(o,s){return se.apply(this,arguments)}function se(){return se=I()(i()().mark(function o(s,r){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.request)("/api/v1/namespaces",d()({method:"GET",params:d()({},s)},r||{})));case 1:case"end":return t.stop()}},o)})),se.apply(this,arguments)}var Fe=n(28058),ye=n(96906),Ze=n(39380),Pe=n(64040),fe=n(2453),me=n(55102),Be=n(74656),Oe=n(55241),Me=n(48096),h=n(67294),Re=n(53464),Te=n(36128),Le=n(91229),he=n(85265),e=n(85893),we=function(s){var r=(0,h.useState)(!1),f=u()(r,2),t=f[0],M=f[1],m=(0,x.useRequest)(function(){return G({envId:s.envId,namespace:s.namespace,name:s.name})},{manual:!0}),D=m.data,L=m.run,O=function(){M(!0),L()},w=function(){M(!1)};return(0,e.jsxs)("div",{children:[(0,e.jsx)("a",{onClick:O,children:"YAML"}),(0,e.jsx)(he.Z,{size:"large",title:s.name,onClose:w,open:t,children:(0,e.jsx)(Le.ZP,{value:D,readOnly:!0,theme:Te.eR,extensions:[(0,Re.rV)()]})})]})},Ne=we,be=n(51042),We=n(36986),_e=n(71230),ae=n(15746),re=n(4393),ue=n(55054),ve=n(96074),Ue=n(72269),$e=n(86250),H=n(66309),Ge=n(75498),pe=n(28248),Ve=function(s){var r=fe.ZP.useMessage(),f=u()(r,2),t=f[0],M=f[1],m=(0,h.useState)(!1),D=u()(m,2),L=D[0],O=D[1],w=(0,h.useState)(!1),N=u()(w,2),A=N[0],V=N[1],J=(0,h.useState)(!1),R=u()(J,2),ie=R[0],E=R[1],F=(0,h.useState)(!1),c=u()(F,2),y=c[0],g=c[1],Q=(0,h.useState)([]),T=u()(Q,2),v=T[0],C=T[1],oe=(0,h.useState)([]),ge=u()(oe,2),Z=ge[0],K=ge[1],Je=(0,h.useState)(""),je=u()(Je,2),xe=je[0],de=je[1],Qe=(0,h.useState)([]),Ee=u()(Qe,2),b=Ee[0],X=Ee[1],ce=(0,x.useRequest)(function(){return S(d()({},s))},{manual:!0}),Y=ce.data,Xe=ce.loading,Ce=ce.run,Ie=(0,x.useRequest)(function(){return B(d()({ipList:v,override:!0},s))},{manual:!0}),ke=Ie.loading,qe=Ie.run;(0,h.useEffect)(function(){Y&&C(Y)},[Y]);var en=function(){O(!0),Ce()},Se=function(l){!l&&(Z.length>0||b.length>0)&&(alert("\u6240\u6709\u53D8\u66F4\u5C06\u88AB\u8FD8\u539F"),K([]),X([]),Ce(),Y&&C(Y)),V(l)},nn=function(){A&&Se(!1),O(!1),K([]),X([]),C([])},tn=function(l){if(v.includes(l)){console.log(l+" already existed, skip");return}Z.push(l),K(Z),v.unshift(l),C(v)},sn=function(l){Z.includes(l)?K(Z.filter(function(k){return k!==l})):b.push(l),X(b),C(v.filter(function(k){return k!==l}))},an=function(){E(!0)},rn=function(){var a=I()(i()().mark(function l(){return i()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,qe();case 2:t.success("\u66F4\u65B0\u6210\u529F"),E(!1),V(!1),K([]),X([]);case 7:case"end":return q.stop()}},l)}));return function(){return a.apply(this,arguments)}}();return(0,e.jsxs)("div",{children:[M,(0,e.jsx)("a",{onClick:en,children:"\u767D\u540D\u5355"}),(0,e.jsxs)(he.Z,{size:"large",title:s.name,onClose:nn,open:L,loading:Xe,children:[(0,e.jsxs)(_e.Z,{gutter:16,children:[(0,e.jsx)(ae.Z,{span:8,children:(0,e.jsx)(re.Z,{children:(0,e.jsx)(ue.Z,{title:"\u603B\u8BA1",value:v.length,valueStyle:{color:"#3f8600"}})})}),(0,e.jsx)(ae.Z,{span:8,children:(0,e.jsx)(re.Z,{children:(0,e.jsx)(ue.Z,{title:"IP \u6570",value:v.length-v.filter(function(a){return a.includes("/")}).length})})}),(0,e.jsx)(ae.Z,{span:8,children:(0,e.jsx)(re.Z,{children:(0,e.jsx)(ue.Z,{title:"CIDR \u6570",value:v.filter(function(a){return a.includes("/")}).length})})})]}),(0,e.jsxs)(ve.Z,{plain:!0,children:[(0,e.jsx)(Ue.Z,{onChange:Se,checked:A,checkedChildren:"\u7F16\u8F91\u6A21\u5F0F",unCheckedChildren:"\u53EA\u8BFB\u6A21\u5F0F"}),A&&(0,e.jsx)(e.Fragment,{children:"\uFF08\u53D8\u52A8\u4EC5\u4E3A\u5B9E\u65F6\u9884\u89C8\uFF0C\u6700\u7EC8\u751F\u6548\u9700\u70B9\u6309\u94AE\u4FDD\u5B58\uFF09"})]}),(0,e.jsxs)($e.Z,{gap:"4px 0",wrap:!0,children:[A&&(0,e.jsxs)(H.Z,{color:"blue",onClick:function(){g(!0)},children:[(0,e.jsx)(be.Z,{}),"\u6279\u91CF\u65B0\u589E"]}),v.map(function(a){return(0,e.jsx)(H.Z,{closable:A,onClose:function(){return sn(a)},color:Z.includes(a)?"blue":"default",children:a},a)})]}),A&&(Z.length>0||b.length>0)&&(0,e.jsx)(Ge.Z,{shape:"circle",type:"primary",icon:(0,e.jsx)(We.Z,{}),tooltip:"\u786E\u8BA4\u53D8\u52A8\u5E76\u4FDD\u5B58",onClick:an}),(0,e.jsx)(pe.Z,{title:"\u6279\u91CF\u65B0\u589E",open:y,onOk:function(){xe.split(`
`).forEach(function(l){tn(l)}),de(""),g(!1)},onCancel:function(){de(""),g(!1)},children:(0,e.jsx)(me.Z.TextArea,{autoSize:!0,placeholder:"\u8BF7\u8F93\u5165 ip / cidr \u5E76\u56DE\u8F66\u6362\u884C\u4EE5\u8FDB\u884C\u5206\u5272\uFF08\u91CD\u590D\u5185\u5BB9\u5C06\u88AB\u5254\u9664\uFF09",value:xe,onChange:function(l){return de(l.target.value)}})}),(0,e.jsxs)(pe.Z,{title:"\u53D8\u52A8\u5185\u5BB9\u6700\u7EC8\u786E\u8BA4",open:ie,onOk:rn,confirmLoading:ke,onCancel:function(){E(!1)},children:[(0,e.jsxs)("p",{children:["\u5220\u9664\u7684\u5185\u5BB9\uFF08\u5171 ",b.length," \u6761\uFF09"]}),b.map(function(a){return(0,e.jsx)(H.Z,{color:"red",children:a},a)}),(0,e.jsx)(ve.Z,{}),(0,e.jsxs)("p",{children:["\u65B0\u589E\u7684\u5185\u5BB9\uFF08\u5171 ",Z.length," \u6761\uFF09"]}),Z.map(function(a){return(0,e.jsx)(H.Z,{color:"blue",children:a},a)})]})]})]})},Ke=Ve,le="prod",Ye=function(){var o=I()(i()().mark(function s(r){var f,t;return i()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!r.envName.includes(le)){m.next=2;break}return m.abrupt("return",[]);case 2:return m.next=4,Ae(d()({},r));case 4:return f=m.sent,t=f.data,m.abrupt("return",t.map(function(D){return{label:D,value:D}}));case 7:case"end":return m.stop()}},s)}));return function(r){return o.apply(this,arguments)}}(),ze=function(){var s=(0,x.useRequest)(function(){return(0,_.hP)()}),r=s.data,f=fe.ZP.useMessage(),t=u()(f,2),M=t[0],m=t[1],D=(0,h.useState)(0),L=u()(D,2),O=L[0],w=L[1],N=(0,h.useState)(""),A=u()(N,2),V=A[0],J=A[1],R=(0,h.useRef)(),ie=[{dataIndex:"index",valueType:"index"},{title:"\u547D\u540D\u7A7A\u95F4",dataIndex:"namespace",initialValue:"low-code",params:{envId:O,envName:V},request:Ye,renderFormItem:function(F,c,y){if(V.includes(le))return(0,e.jsx)(me.Z,{placeholder:"\u8BF7\u624B\u52A8\u8F93\u5165 namespace",allowClear:!0});var g={value:y.getFieldValue("".concat(F.dataIndex)),onChange:function(T){var v={};if(v["".concat(F.dataIndex)]=T,y.setFieldsValue(v),T!==void 0){var C;R==null||(C=R.current)===null||C===void 0||C.submit()}}};return(0,e.jsx)(Be.Z,d()({showSearch:!0,allowClear:!0,options:c.options},g))}},{title:"ingress \u7C7B",search:!1,dataIndex:"ingressClass"},{title:"ingress \u540D\u79F0",dataIndex:"ingressName",copyable:!0,search:!1},{title:"\u57DF\u540D",dataIndex:"domain",render:function(F,c){var y=Object.keys(c.rules);return(0,e.jsx)("div",{children:y.map(function(g,Q){var T=function(){return(0,e.jsx)("div",{children:c.rules[g].map(function(C,oe){return(0,e.jsx)("p",{children:C},oe)})})};return(0,e.jsx)(Oe.Z,{content:T,children:(0,e.jsx)("p",{children:g.includes("*")?g:(0,e.jsx)("a",{href:"http://"+g,target:"_blank",rel:"noreferrer",children:g})})},Q)})})}},{title:"\u64CD\u4F5C",search:!1,valueType:"option",render:function(F,c){return[(0,e.jsx)(Ke,{envId:c.envId,namespace:c.namespace,name:c.ingressName},0),(0,e.jsx)(Ne,{envId:c.envId,namespace:c.namespace,name:c.ingressName},1),(0,e.jsx)(ye.Z,{menus:[{key:"editAnnotations",name:"\u914D\u7F6E Annotations"}],onSelect:function(g){switch(g){case"editAnnotations":alert("edit annotations");break;default:break}}},2)]}}];return(0,h.useEffect)(function(){r&&r.length>0&&(w(r[0].id),J(r[0].name))},[r]),(0,e.jsxs)(Ze._z,{children:[m,r&&O>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me.Z,{type:"card",onChange:function(F){w(Number(F));var c=r.find(function(y){return y.id===Number(F)});c&&(J(c.name),c.name.includes(le)&&M.warning("\u5F53\u524D\u4E3A\u751F\u4EA7\u73AF\u5883\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"))},items:r.map(function(E){return{icon:E.name.includes("prod")?(0,e.jsx)(Fe.Z,{}):null,key:E.id.toString(),label:E.description}})}),(0,e.jsx)(Pe.Z,{formRef:R,columns:ie,params:{envId:O},request:U})]})]})},He=ze},612:function(De,z,n){n.d(z,{Dk:function(){return x},hP:function(){return I},iO:function(){return $}});var ee=n(15009),u=n.n(ee),ne=n(97857),i=n.n(ne),te=n(99289),d=n.n(te),W=n(80854);function I(j){return _.apply(this,arguments)}function _(){return _=d()(u()().mark(function j(S){return u()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.abrupt("return",(0,W.request)("/api/v1/envs",i()({method:"GET"},S||{})));case 1:case"end":return B.stop()}},j)})),_.apply(this,arguments)}function x(j,S){return U.apply(this,arguments)}function U(){return U=d()(u()().mark(function j(S,P){return u()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,W.request)("/api/v1/envs",i()({method:"POST",data:i()({},S)},P||{})));case 1:case"end":return p.stop()}},j)})),U.apply(this,arguments)}function $(j,S){return G.apply(this,arguments)}function G(){return G=d()(u()().mark(function j(S,P){return u()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,W.request)("/api/v1/envs/"+S.id,i()({method:"DELETE"},P||{})));case 1:case"end":return p.stop()}},j)})),G.apply(this,arguments)}}}]);
